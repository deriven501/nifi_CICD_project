pipeline {
    agent any
    stages {
    	stage('clean workspace') {
        	steps {
            	cleanWs()
            }
        }
        stage('Checkout project repo') {
            steps {
                sh """
                    git clone https://github.com/deriven501/nifi_CICD_project.git
                """
            }
        }

        stage('Checkout Nifi Repo') {
            steps {
                dir('nifi_CICD_project') {
                    sh 'git clone "https://github.com/apache/nifi.git"'
                }
                
                dir('nifi_CICD_project/nifi') {
                    sh 'git checkout rel/nifi-1.26.0'
                }
                
            }
        }
        stage('Build nifi') {
            steps {
                dir("nifi_CICD_project/nifi/nifi-assembly") {
                      sh 'mvn clean install -U -DskipTests'
                }
            }
        }

        stage('Terraform initialization') {
            steps {
                dir('nifi_CICD_project/terraform') {
                    sh """
                        terraform init -upgrade
                        terraform plan
                    """
                }
            }

        }

        // stage('Generate Inventory') {
        //     steps {
        //         sh 'scripts/prepare-inventory.sh'
        //     }
        // }
    }
}